# Notes

## 2023.01.03

### 目前情况

- 整理出了2193条输入数据
    - 字段取自参考论文中的*兼容模型（Compact Model）*，
        共15个自变量，1个应变量（是否PICS）。
    - 这些数据是筛选后的，不含任何缺省值。
        （包括下面的PICS判断，无法确定的都已删去。）
    - PICS判断标准如下：（这些变量不必全部查到，
        只要有一个存在且不满足，就认为不是PICS；全部
        存在且满足，才认为是PICS；无法判别的舍弃。）
        - 住院时间（actualhospitallos） >= 10 天
        - C-反应蛋白（CRP） > 3.2 mg/dL
        - 淋巴细胞（lymphs） < 20%
        - 白蛋白（albumin） < 3 g/dL
        - 血清前白蛋白（prealbumin） < 10 mg/dL

- 使用以上数据，分别对14种模型进行了训练和测试：
    - 使用了*交叉验证（Cross Validation）* ，具体来说是
       *分层K折交叉验证（Stratified K-Fold C.V.）*，
        就是保证每折训练/测试数据中正反例比例相同的CV。

### 接下来的方向

- 数据方面：
    1. 同一个病人可能有多次实验数据，现在是简单取平均，
        丢失了时间信息。接下来可以尝试保留时间，实现一个
        病人有不同时间的多条数据，增加模型可靠性。
    2. 现在的数据中，PICS的正例只有0.68%，可能导致模型偏见，
        之后可以研究一下消除偏见的方法。

- 模型方面：
    - 现在只是简单套用了模型，仅个别模型进行了部分调参，
        但是调参应该是机器学习模型的重要部分，之后还要
        继续进行，给每个模型找到最合适的参数，最终都用
        最好的结果比较。

## 2023.01.05

整体思路参考这篇论文：
*A Machine-Learning Approach for*
*Dynamic Prediction of Sepsis-Induced Coagulopathy*
*in Critically Ill Patients With Sepsis.pdf*

1. 建立 Full Model（尽可能多的变量）
2. 用 Cross Validation 比较15个模型，取最好的进行后续操作
3. 用 Bayesian Optimization 优化超参数
4. 用 SHAP 解释各个变量对结果的贡献程度
5. 取 SHAP Value 最大的15个建立 Compact Model（简化版模型）
6. 基于 Compact Model 构建在线工具

程序方面我感觉没什么问题，都可以做，就是需要时间。
目前的模型正在照着这个思路改，问题不大，
主要是数据量太大，程序运行需要时间，调试比较费时……

最后也可以做个在线工具，作为一个亮点。
等模型做好之后再做在线工具，估计两天就可以做好。

论文我觉得可以先分工。论文内容大致可以分为：

1. 引入
2. 数据准备
3. 模型建立（思路就是上面的1~5）
4. 结果展示

分工可以基于这几个部分。我觉得最好是有一个人主管论文，
负责一下排版，其他同学只提供内容，保证排版的统一。

## 2023.01.17

研究的整体思路参考这篇论文：
*A Machine-Learning Approach for*
*Dynamic Prediction of Sepsis-Induced Coagulopathy*
*in Critically Ill Patients With Sepsis.pdf*

1. 建立 Full Model（尽可能多的变量）
2. 用 Cross Validation 比较若干模型，取最好的进行后续操作
3. 用 SHAP 解释各个变量对结果的贡献程度
4. 取 SHAP Value 最大且方便测量的部分变量建立 Compact Model（简化版模型）
5. 用 Bayesian Optimization 优化超参数
6. 基于 Compact Model 构建在线工具

目前 Full Model 数据提取基本完成。
使用 eICU 中的数据，选取了60个自变量，对第二天的 PICS 情况进行预测。
（训练数据的输出为：当天或第二天满足PICS条件。）
共17,728位病人、100,133条数据，正例占3.86%。

> 与参考论文相比，还差一些自变量。
> 有几个是呼吸相关的，没搞清楚，参考论文研究 SIC 就是呼吸相关的，
> 我们研究的 PICS 感觉和炎症相关，少这几个呼吸变量应该问题不大。
> 还有几个是 SOFA 评分，没找到，但是已经有 Apache IV 评分了，
> 听说 Apache 评分比 SOFA 评分更好，所以也先忽略。

接着，使用14种模型进行了10折交叉验证，目前结果如下：

|   Model Name | Accuracy Mean | Accuracy Std | AUC Mean | AUC Std |
|-------------:|--------------:|-------------:|---------:|--------:|
|     CatBoost |        0.9957 |       0.0007 |   0.9957 |  0.0021 |
|      LightGB |        0.9953 |       0.0010 |   0.9960 |  0.0018 |
|      XGBoost |        0.9951 |       0.0008 |   0.9951 |  0.0018 |
|       HistGB |        0.9942 |       0.0012 |   0.9956 |  0.0021 |
|     AdaBoost |        0.9928 |       0.0021 |   0.9946 |  0.0023 |
| DecisionTree |        0.9903 |       0.0017 |   0.9482 |  0.0075 |
|          MLP |        0.9822 |       0.0032 |   0.9742 |  0.0078 |
|          SVM |        0.9729 |       0.0046 |   0.9560 |  0.0052 |
|     Logistic |        0.9658 |       0.0063 |   0.9547 |  0.0053 |
|   ExtraTrees |        0.9614 |       0.0061 |   0.9773 |  0.0046 |
|   NaiveBayes |        0.9614 |       0.0061 |   0.6900 |  0.0648 |
|        Ridge |        0.9613 |       0.0060 |   0.9524 |  0.0088 |
|          LDA |        0.9610 |       0.0076 |   0.9524 |  0.0088 |
|          KNN |        0.9507 |       0.0063 |   0.5398 |  0.0171 |
